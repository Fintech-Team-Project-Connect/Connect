<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
   <title>Crypto Mobile Template</title>

   <!-- Google font file. If you want you can change. -->
   <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,900" rel="stylesheet">

   <!-- Fontawesome font file css -->
   <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">

   <!-- Animate css file for css3 animations. for more : https://daneden.github.io/animate.css -->
   <!-- Only use animate action. If you dont use animation, you don't have to add.-->
   <link rel="stylesheet" type="text/css" href="css/animate.css">
   <link rel="stylesheet" type="text/css" href="css/cryptocoins.css">
   <link rel="stylesheet" type="text/css" href="plugins/c3-chart/c3.css">

   <!-- Template global css file. Requared all pages -->
   <link rel="stylesheet" type="text/css" href="css/global.style.css">

   <!-- Swiper slider css file -->
   <link rel="stylesheet" href="css/swiper.min.css">

   <!--turbo slider plugin css file -->
   <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
   <link rel="stylesheet" type="text/css" href="plugins/turbo-slider/turbo.css">

</head>

<body>
   
   <div class="wrapper ">
        <div class="nav-menu">
            <nav class="menu">
                
                <!-- Menu navigation start -->
                <div class="nav-container">
                <ul class="main-menu">
                    <li class="">
                        <a href="index.html"><img src="img/content/icons/1.png" alt=""><strong class="special">Dashboard</strong> </a>
                    </li>
                    <li class="active">
                        <a href="wallet.html"><img src="img/content/icons/2.png" alt=""><strong class="special">My Walet</strong> </a>
                    </li>
                    <li class="">
                        <a href="trading.html"><img src="img/content/icons/3.png" alt=""><strong class="special">Crypto Trade</strong> </a>
                    </li>
                    <li class="">
                        <a href="buy-sell.html"><img src="img/content/icons/6.png" alt=""><strong class="special">Buy & sell</strong> </a>
                    </li>
                    <li class="">
                        <a href="profile.html"><img src="img/content/icons/5.png" alt=""><strong class="special">Trader Profile</strong> </a>
                    </li>
                    <li class="">
                        <a href="affiliate.html"><img src="img/content/icons/4.png" alt=""><strong class="special">Affiliate System</strong> </a>
                    </li>
                    <li class="">
                        <a href="setting.html"><img src="img/content/icons/11.png" alt=""><strong class="special">Settings</strong> </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);"><img src="img/content/icons/9.png" alt=""><strong class="special">Login/Register</strong> <span class="fa fa-angle-down"></span></a>
                        <ul>
                            <li><a href="login.html" data-loader="show">Login</a></li>
                            <li><a href="signup.html" data-loader="show">Register</a></li>
                            <li><a href="forgot-password.html" data-loader="show">Forgot Password</a></li>
                        </ul>
                    </li>
                    
                    <li>
                        <a href="javascript:void(0);"><img src="img/content/icons/8.png" alt=""> <strong class="special">Wizards</strong> <span class="fa fa-angle-down"></span></a>
                        <ul>
                            <li><a href="wizard-default.html" data-loader="show">Wizard Default</a></li>
                            <li><a href="wizard-fullscreen.html" data-loader="show">Wizard Fullscreen</a></li>
                        </ul>
                    </li>
                    <li class="">
                        <a href="charts.html"><img src="img/content/icons/14.png" alt=""><strong class="special">Charts</strong> </a>
                    </li>
                    <li>
                        <a href="forms.html" data-loader="show"><img src="img/content/icons/7.png" alt=""><strong class="special">Form Elements</strong></a>
                    </li>
                    <li>
                        <a href="#"><img src="img/content/icons/10.png" alt=""><strong class="special"> Components</strong> <span class="fa fa-angle-down"></span></a>
                        <ul>
                            <li><a href="tab-bottom.html" data-loader="show">Tab (Bottom)</a></li>
                            <li><a href="tab-top.html" data-loader="show">Tab (Top)</a></li>
                            <li><a href="accordion.html" data-loader="show">Accordion</a></li>
                            <li><a href="popup.html" data-loader="show">Popup Modal</a></li>
                            <li><a href="checkbox-list.html" data-loader="show">Check List</a></li>
                            <li><a href="link-list.html" data-loader="show">Link List</a></li>
                            <li><a href="link-list-two-column.html" data-loader="show">Two Column Links</a></li>
                        </ul>
                    </li>
                    <li class="">
                        <a href="#"><img src="img/content/icons/15.png" alt=""><strong class="special"> Pages</strong> <span class="fa fa-angle-down"></span></a>
                        <ul>
                            <li class=""><a href="profile.html" data-loader="show">User Profile</a></li>
                            <li><a href="search-result.html" data-loader="show">Search Results</a></li>
                            <li><a href="contact.html" data-loader="show">Contact</a></li>
                            <li><a href="blank.html" data-loader="show">Blank Page</a></li>
                        </ul>
                    </li>
                </ul>
                </div>
            <!-- Menu navigation end -->
            </nav>
        </div>
        <div class="wrapper-inline">
            <!-- Header area start -->
            <header class="no-background"> <!-- extra class no-background -->

                <a class="go-back-link" href="javascript:history.back();"><i class="fa fa-arrow-left"></i></a>
                <div class="search-button" data-search="open">
                <img src="img/content/notification1.png" class="not-icon1" alt="">
                <img src="img/content/notification2.png" class="not-icon2" alt="">
                </div>

                <div class="navi-menu-button">
                <em></em>
                <em></em>
                <em></em>
                </div>

            </header>
            <!-- Header area end -->

            <!--NOTIFICATION BOX CONTENT START-->
            <div class="search-form">
                <span class="close-search-form" data-search="close"><i class="fa fa-times"></i> </span>
                <form>
                <div class="search-input">
                    <input type="text" name="q" class="form-element" placeholder="Search...">
                    <button type="submit" class="search-input-btn"><i class="fa fa-arrow-right"></i></button>
                </div>
                </form>
                <ul class="notification-list list-unstyled">
                <li>
                    <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <div class="">
                                <h5 class="coin-name">You have 3 notifications</h5>
                                </div>
                            </div>
                            <div>
                                <a href=""><small class="text-muted d-block">mark all as read</small></a>
                            </div>
                            </div>
                </li>
                <li>
                    <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                <div class="notice-icon available">
                                    <i class="fa fa-check"></i>
                                </div>
                                <div class="ml-10">
                                    <h4 class="coin-name">Successful transaction 0.01 BTC</h4>
                                    <small class="text-muted">15 min ago</small>
                                </div>
                                </div>
                            </div>
                </li>
                <li>
                    <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                <div class="notice-icon away">
                                    <i class="fa fa-clock-o"></i>
                                </div>
                                <div class="ml-10">
                                    <h4 class="coin-name">4 of Pending Transactions!</h4>
                                    <small class="text-muted"> 12 hours ago</small>
                                </div>
                                </div>
                            </div>
                </li>
                <li>
                    <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                <div class="notice-icon busy">
                                    <i class="fa fa-times"></i>
                                </div>
                                <div class="ml-10">
                                    <h4 class="coin-name">Cancelled Order of 200 ICO</h4>
                                    <small class="text-muted">15 Feb - 08:34</small>
                                </div>
                                </div>
                            </div>
                </li>
                <li>
                    <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                <div class="notice-icon available">
                                    <i class="fa fa-check"></i>
                                </div>
                                <div class="ml-10">
                                    <h4 class="coin-name">Great Speed Notify of 1.34 LTC</h4>
                                    <small class="text-muted">24 jan - 20:43</small>
                                </div>
                                </div>
                            </div>
                </li>
                <li>
                    <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                <a href="" class="text-muted">Read all notifications</a>
                                </div>
                            </div>
                </li>
                
                </ul>
            </div>
            <!--NOTIFICATION BOX CONTENT END-->

            <!-- Page content start -->
            <main class="margin mt-0">
                <div class="dash-balance">
                    <div class="dash-content relative">
                        <h3 class="w-text" id = "study-title"></h3>
                        <div class="notification">
                            <a href="/createStudy" data-loader="show"><i class="fa fa-plus"></i></a>
                        </div>
                    </div>
                </div>

                <section class="bal-section container"></section>   
                <section class="wallets-list container">
                    <h4 class="title-main">참여 중인 스터디원 명단</h4>
                    <!--expendable list item -->
                    <div class="expandable-item accordion" data-group="accordion1">
                        <div class="expandable-header purp">
                            <i class="cc ETH-alt"></i>
                            <h3 class="list-title" id = "studyUser">스터디원1</h3>
                            <i class="list-arrow fa fa-angle-down"></i>
                        </div>
                        <div class="expandable-content">
                            <div class="padding-content">
                                <h4>스터디원 내역</h4>
                                <div class="recent-trans">
                                    <ul class="dropdown-menu-list list-unstyled no-mb">
                                        <li>
                                            <div class="notice-icon">
                                                <i class="fa fa-institution"></i>
                                            </div>
                                            <div>
                                                <span class="name">
                                                    <strong>벌금</strong>
                                                    <span class="time small">+ 3.39498 ETH</span>
                                                </span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                </section>

                <section class="container" heignt=10px>
                    <div class="resources-card-wrapper mt-15"  >
                        <a href="buy-sell.html" class="buy-card mr-10">
                            <div class="flex-column flex-md-row">
                                <img src="img/content/p1.png"  alt="">
                                <h4>스터디원 추가 +</h4>
                                <p class="g-text mb-0 font-weight-medium">클릭하면 스터디원 추가 </p>
                            </div>
                        </a>                        
                    </div>
                </section>
               
                <section class="container">
                    <h4 class="title-main">스터디 날짜 및 시간</h4>
                        <ul class="transaction-list list-unstyled">
                            <li>
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <img class="img-xs" src="img/content/coin1.png" alt="coin image">
                                        <div class="ml-10">
                                            <h4 class="coin-name" id="sDate"></h4>                
                                            <!-- 
                                            <small class="text-muted">아무값<span class="ml-10">아무값</span></small>
                                            -->
                                        </div>
                                    </div>
                                    <div>
                                        <a href = "change_datetime.html">
                                            <small class="d-block mb-0 txt-green">날짜 및 시간 변경</small>
                                            <small class="text-muted d-block"></small>
                                        </a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                        
                    <h4 class="title-main">스터디 비용(1인당)</h4>
                        <ul class="transaction-list list-unstyled">
                            <li>
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <img class="img-xs" src="img/content/coin2.png" alt="coin image">
                                        <div class="ml-10">
                                            <h4 class="coin-name" id="cost"></h4>
                                            <!--
                                            <small class="text-muted">아무값<span class="ml-10">아무값</span></small>
                                            -->
                                        </div>
                                    </div>
                                    <div>
                                        <button id = "changeCost">
                                            <small class="d-block mb-0 txt-green">금액변경</small>
                                            <small class="text-muted d-block"></small>
                                        </button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    <h4 class="title-main">스터디카페에 보낼 날짜</h4>
                        <ul class="transaction-list list-unstyled">
                            <li>
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <img class="img-xs" src="img/content/coin1.png" alt="coin image">
                                        <div class="ml-10">
                                            <h4 class="coin-name" id="cafeTrans"></h4>
                                        </div>
                                    </div>
                                    <div>
                                        <a href = "change_datetime.html">
                                            <small class="d-block mb-0 txt-green">계좌변경</small>
                                            <small class="text-muted d-block"></small>
                                        </a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    <h4 class="title-main">스터디원으로부터 받을 날짜</h4>
                        <ul class="transaction-list list-unstyled">
                            <li>
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <img class="img-xs" src="img/content/coin1.png" alt="coin image">
                                        <div class="ml-10">
                                            <h4 class="coin-name" id="indiTrans"></h4>
                                        </div>
                                    </div>
                                    <div>
                                        <a href = "change_datetime.html">
                                            <small class="d-block mb-0 txt-green">계좌변경</small>
                                            <small class="text-muted d-block"></small>
                                        </a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                </section>

                <footer>
                <div class="container">
                    <ul>
                        <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                        <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="#"><i class="fa fa-google"></i></a></li>
                        <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                    </ul>
                    <p>Copyright 짤 All Right Reserved</p>
                </div>
                </footer>
            </main>
            <!-- Page content end -->
        </div>
   </div>

   <!--Page loader DOM Elements. Requared all pages-->
   <div class="sweet-loader">
      <div class="box">
           <div class="circle1"></div>
           <div class="circle2"></div>
           <div class="circle3"></div>
      </div>
   </div>

   <!-- JQuery library file. requared all pages -->
   <script src="js/jquery-3.2.1.min.js"></script>

   <!-- Swiper JS -->
    <script src="js/swiper.min.js"></script>

   <!-- Template global script file. requared all pages -->
   <script src="js/app-charts.js"></script>
   <script src="js/global.script.js"></script>
   
   <script>
        var jwtToken = sessionStorage.getItem('jwtToken');
        
        // * 쿼리스트링
        function getQueryStringObject() {
            var a = window.location.search.substr(1).split('&');
            if (a == "") return {};
            var b = {};
            for (var i = 0; i < a.length; ++i) {
                var p = a[i].split('=', 2);
                if (p.length == 1)
                    b[p[0]] = "";
                else
                    b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
            }
            return b;
		}
        var qs = getQueryStringObject();
        var i = qs.sId - 1;
        var a = 0;
        console.log('\n* i 값 확인 -> ' + i + '\n* qs.sId 값 확인 -> ' + qs.sId);
    
        // * 스터디 목록
        function fetchStudyList() {
			$.ajax({
                url:'http://localhost:3000/studyList',
                type : 'POST',
                headers : {
					'x-access-token' : jwtToken
                },
                success:function(data) {

                    console.log('\n * data 확인(studyMain.ejs) -> ');
                    console.log(data);
                    for (var v = 0; v < data.length; v++) {
                        if (data[v].sId == qs.sId) {
                            a = v;
                        }
                    }
                    console.log(a);
                    console.log(i);

                    var cafeTrans ;
                    var year = new Date(data[a].sDate).getFullYear(); 
                    var month = new Date(data[a].sDate).getMonth() + 1 ; 
                    var day = new Date(data[a].sDate).getDate();
                    console.log(year + ' 년'+month +'월'+day+'일');
                    var cafeTrans = day - data[a].cafeTrans;
                    var indiTrans = day - data[a].indiTrans;
                    console.log(cafeTrans + '카페'+indiTrans +'개인');
                    $("#study-title").html(data[a].sName + " 스터디");
                    $("#sDate").text(year + '년 '+month +'월 '+day+'일');
                    $("#cost").html(data[a].cost + "원");
                    $("#cafeTrans").text(year + '년 '+month +'월 '+cafeTrans+'일');
                    $("#indiTrans").text(year + '년 '+month +'월 '+indiTrans+'일');
                        // $("#study-title").text(data[a].sName + " 스터디");
                        // $("#sDate").text(data[a].sDate);
                        // $("#cost").text(data[a].cost + "원");   
                        // $("#cafeTrans").html("스터디일 기준, " + data[a].cafeTrans + "일 전에 " + data[a].cName + "로 입금됩니다.");
                        // $("#indiTrans").html("스터디일 기준, " + data[a].indiTrans + "일 전에 스터디원의 계좌로부터 출금됩니다.");
                
                
                    // * 입금이체(스터디원1 ==> 우리App) 기능이 발생하는 function
                    function fetchDeposit() {
                        $.ajax({
                            url:'http://localhost:3000/deposit',
                            type : 'POST',
                            headers : {
                                'x-access-token' : jwtToken
                            },
                            success:function(data) {
                                if(data == 1)
                                    $("#cafeTrans").text("스터디카페의 계좌로 입금이 완료되었습니다.")
                            }
                        }); 
                    }
                    //fetchWithdraw();
                    //fetchDeposit();
                    /*
                    if sys의 날짜 => (data[i].sDate - data[i].indiTrans)
                    {
                        
                        fetchDeposit();
                        console.log('\n* data[i].sDate - data[i].indiTrans -> ');
                        console.log(data[i].sDate - data[i].indiTrans);
                    }
                    else
                    {
                        $("#indiTrans").html("스터디일 기준, " + data[i].indiTrans + "일 전에 스터디원의 계좌로부터 출금됩니다.");
                        $("#cafeTrans").html("스터디일 기준, " + data[i].cafeTrans + "일 전에 " + data[i].cName + "로 입금됩니다.");
                    }
                    */
                }
            }); 
        }
        fetchStudyList();

        // * 출금이체(스터디원1 ==> 우리App) 기능이 발생하는 function
        function fetchWithdraw() {
            $.ajax({
                url:'http://localhost:3000/withdraw',
                type : 'POST',
                headers : {
                    'x-access-token' : jwtToken
                },
                success:function(data) {
                    if(data == 1)
                        $("#indiTrans").text("스터디원의 계좌로부터 출금이 완료되었습니다.")
                }
            }); 
        }
        //fetchWithdraw();

        $("#changePay").click(function () {
			window.open("changePay", "금액 변경", "width=800,height=400");
		})
    </script>
</body>
</html>